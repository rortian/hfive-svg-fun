<!doctype html>
<html>
  <head>
    <title>Scratch</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.js" type="text/javascript"></script>
    <script type="text/javascript">

      function makeSVG(tag, attrs) {
        var el= document.createElementNS('http://www.w3.org/2000/svg', tag);
        for (var k in attrs)
          el.setAttribute(k, attrs[k]);
        return el;
      }

      function use_this(id){
        var to_return = makeSVG('use')
        to_return.setAttributeNS("http://www.w3.org/1999/xlink",'href',id)
        return to_return
      }

      function defs(r){
        var defs = makeSVG('defs',{})
        var paths = []
        paths[0] = makeDefPath(r)
        defs.appendChild(paths[0])
        $('svg').append(defs)
      }

      function make_circle(r){
          var all = makeSVG('g',{id:'#all0'})
          var use = use_this("#circle0")

          all.appendChild(use)

          all.appendChild(quad_one(r))

          all.appendChild(quad_three(r))

          group = makeSVG('g',{transform:"translate(346.5,346.5) rotate(180,182.5,182.5)"})

          use = use_this("#circle0")

          group.appendChild(use)

          all.appendChild(quad_four(r))

          $('svg').append(all)

      }

      function quad_one(r){
          var use = use_this("#circle0")

          var transform_string = "translate("+r+") rotate(90,"
          transform_string += r/2 +","+ r/2 +")"

          var group = makeSVG('g',{transform:transform_string})

          group.appendChild(use)

          return group;
      }

      function quad_three(r){
          var use = use_this("#circle0")

          var transform_string = "translate(0,"+r+") rotate(-90,"
          transform_string += r/2 +","+ r/2 +")"

          var group = makeSVG('g',{transform:transform_string})

          group.appendChild(use)

          return group;
      }

      function quad_four(r){
          var use = use_this("#circle0")

          var transform_string = "translate("+r+","+r+") rotate(180,"
          transform_string += r/2 +","+ r/2 +")"

          var group = makeSVG('g',{transform:transform_string})

          group.appendChild(use)

          return group;
      }

      function makeDefPath(r){
          return makeSVG('path',{d:first_part(r),id:"circle0", style:"fill:#999966;fill-opacity:1"})
      }

      function first_part(r){
        return "M " + r + ",0 " + figure_out_ellipse(r) + " z "
      }

      function figure_out_ellipse(r){
        var first_leg = "a"+r+","+r+" 0 0,0 "+(-r)+","+r
        var second_leg = "a"+r/3+","+r/3+" 0 0,1 "+2*r/3+",0"
        var third_leg = "a"+r/3+","+r/3+" 0 0,1 "+r/3+","+(-r/3)
        var fourth_leg = "a"+r/3+","+r/3+" 0 0,1 0,"+(-2*r/3)
        return first_leg + second_leg + third_leg + fourth_leg
      }

      $(document).ready(function(){
          defs(346.5)

          make_circle(346.5)
          });
    </script>
  </head>
  <body>
    <svg version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" width="729" height="729"></svg>
  </body>
</html>
